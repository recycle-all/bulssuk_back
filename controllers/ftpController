const ftp = require('basic-ftp');

exports.getImage = async (req, res) => {
  const { filename } = req.params;
  const client = new ftp.Client();

  try {
    await client.access({
      host: process.env.FTP_HOST, // 환경 변수 사용
      user: process.env.FTP_USER, // 환경 변수 사용
      password: process.env.FTP_PASSWORD, // 환경 변수 사용
    });

    // FTP에서 파일을 스트림으로 가져와 클라이언트로 전송
    res.setHeader('Content-Type', 'image/jpeg'); // MIME 타입 설정
    await client.downloadTo(res, `/images/${filename}`); // 클라이언트로 직접 다운로드
  } catch (err) {
    console.error('FTP Error:', err);
    res.status(500).send('Error retrieving file');
  } finally {
    client.close();
  }
};
